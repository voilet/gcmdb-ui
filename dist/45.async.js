(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{"0kyw":function(e,t,a){e.exports={"switch-btn-block":"antd-pro-gcmdb-ui-src-components-access-role-assign-modal-switch-btn-block","table-block":"antd-pro-gcmdb-ui-src-components-access-role-assign-modal-table-block"}},GPpn:function(e,t,a){"use strict"},"T/Ci":function(e,t,a){e.exports={tableList:"antd-pro-gcmdb-ui-src-pages-g-power-role-role-list-tableList",tableListOperator:"antd-pro-gcmdb-ui-src-pages-g-power-role-role-list-tableListOperator",tableListForm:"antd-pro-gcmdb-ui-src-pages-g-power-role-role-list-tableListForm",submitButtons:"antd-pro-gcmdb-ui-src-pages-g-power-role-role-list-submitButtons"}},fepD:function(e,t,a){"use strict";var n=a("0ZgE");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("NG6T");var l=n(a("uZXS"));a("ggfa");var r=n(a("M+wZ"));a("9sh3");var o=n(a("r3sT"));a("3PXm");var s=n(a("m2aW")),i=n(a("TFzq")),d=n(a("DEU0")),c=n(a("+hkI")),u=n(a("54rf")),f=n(a("oHNe"));a("Sn19");var p=n(a("9yki")),h=n(a("bRCM")),m=(n(a("2Uje")),n(a("0kyw"))),g=[{title:"资源名称",dataIndex:"name",key:"name"},{title:"类别",dataIndex:"rtype",key:"rtype",width:"100px",render:function(e,t){console.log("text",e);var a;return a=0==e?h.default.createElement(p.default,{color:"#108ee9"},"区域"):1==e?h.default.createElement(p.default,{color:"#009900"},"菜单"):h.default.createElement(p.default,{color:"#944dff"},"按钮"),h.default.createElement("div",null,a)}},{title:"地址",dataIndex:"link_url",width:"30%",key:"link_url"}],v=function(e){function t(e){var a;return(0,i.default)(this,t),a=(0,c.default)(this,(0,u.default)(t).call(this,e)),a.getExpandKeys=function(e){e.forEach(function(e){1===e.has_licence&&a.selectedRowKeys.push(e.ID),e.children&&(a.expandItem.push(e.ID),a.getExpandKeys(e.children))})},a.getAssingInfo=function(e){var t=e;(0,a.props.dispatch)({type:"grole/getRoleResource",payload:{roleid:t,cb:function(e){a.getExpandKeys(e.data),a.initExpandItem()}}}),a.setState({visible:!0}),a.params.roleId=t,a.params.resourceIds=a.selectedRowKeys},a.initExpandItem=function(){var e=a.state,t=e.selectedRowKeys,n=e.expandItem;a.expandItem.forEach(function(e){n.push(e)}),a.selectedRowKeys.forEach(function(e){t.push(e)}),a.setState({expandItem:n,selectedRowKeys:t})},a.submitAssign=function(){console.log("分配成功,请求参数为：",a.params),a.init()},a.cancelAssign=function(){a.init()},a.init=function(){var e=a.state.selectedRowKeys;a.params={},a.selectedRowKeys=[],a.expandItem=[],e.splice(0,e.length),a.setState({isExpandAll:!0,visible:!1,selectedRowKeys:e,expandItem:[]})},a.expandSwitch=function(e){var t=[];a.expandItem.forEach(function(e){t.push(e)}),a.setState({isExpandAll:e,expandItem:e?t:[]})},a.expandRow=function(e,t){var n=a.state.expandItem;if(e)n.push(t.ID);else{var l=n.indexOf(t.ID);n.splice(l,1)}a.setState({expandItem:n,isExpandAll:n.length===a.expandItem.length})},a.openModal=function(){},a.state={isExpandAll:!0,expandItem:[],selectedRowKeys:[],visible:!1},a.expandItem=[],a.selectedRowKeys=[],a.params={},a.rowSelection={onChange:function(e,t){var n=t.map(function(e){return e.ID});a.params.resourceIds=n},onSelect:function(e,t,n){var l=a.state.selectedRowKeys;if(t)l.push(e.ID);else{var r=l.indexOf(e.ID);l.splice(r,1)}a.setState({selectedRowKeys:l})},onSelectAll:function(e,t,n){var l=a.state.selectedRowKeys;e?n.forEach(function(e){l.push(e.ID)}):l.splice(0,l.length),a.setState({selectedRowKeys:l})},selectedRowKeys:a.state.selectedRowKeys},a}return(0,f.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.assignInfo,n=t.record,i=this.state,d=i.expandItem,c=i.isExpandAll,u=i.visible;return h.default.createElement(h.default.Fragment,null,h.default.createElement(s.default,{onClick:function(){return e.getAssingInfo(n)}},"分配"),h.default.createElement(l.default,{title:"选择资源",visible:u,onOk:this.submitAssign,onCancel:this.cancelAssign,okText:"保存",width:1e3},h.default.createElement("div",{className:m.default["switch-btn-block"]},h.default.createElement(o.default,{checkedChildren:"全部展开",unCheckedChildren:"全部收缩",checked:c,onChange:this.expandSwitch})),h.default.createElement("div",{className:m.default["table-block"]},h.default.createElement(r.default,{pagination:!1,columns:g,rowSelection:this.rowSelection,dataSource:a.data,expandedRowKeys:d,onExpand:this.expandRow,rowKey:function(e){return e.ID}}))))}}]),t}(h.default.Component),y=v;t.default=y},iYqO:function(e,t,a){e.exports={activeChart:"antd-pro-gcmdb-ui-src-components-access-role-index-activeChart",activeChartGrid:"antd-pro-gcmdb-ui-src-components-access-role-index-activeChartGrid",activeChartLegend:"antd-pro-gcmdb-ui-src-components-access-role-index-activeChartLegend"}},obT9:function(e,t,a){"use strict";var n=a("VY4n"),l=a("0ZgE");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("ggfa");var r=l(a("M+wZ"));a("840F");var o=l(a("6eYs"));a("3PXm");var s=l(a("m2aW"));a("8EHj");var i=l(a("6xKx"));a("pdEl");var d=l(a("0Hx8")),c=l(a("U2oY")),u=l(a("bVKW")),f=l(a("TFzq")),p=l(a("DEU0")),h=l(a("+hkI")),m=l(a("54rf")),g=l(a("oHNe"));a("0lkx");var v=l(a("gEKc"));a("6ASg");var y=l(a("pKc7")),b=n(a("bRCM")),I=(l(a("I9Uw")),l(a("iYqO"))),w=l(a("fepD")),E=(y.default.Option,function(e){var t=e.editable,a=e.value,n=e.onChange;return b.default.createElement("div",null,t?b.default.createElement(v.default,{style:{margin:"-5px 0"},value:a,onChange:function(e){return n(e.target.value)}}):a)}),k=function(e){function t(){var e,a;(0,f.default)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=(0,h.default)(this,(e=(0,m.default)(t)).call.apply(e,[this].concat(l))),a.state={selectedRowKeys:[],totalCallNo:0,data:[],selectedLine:!1},a.handleRowSelectChange=function(e,t){var n=t.reduce(function(e,t){return e+parseFloat(t.callNo,10)},0);a.props.onSelectRow&&a.props.onSelectRow(t),a.setState({selectedRowKeys:e,totalCallNo:n})},a.handleTableChange=function(e,t,n){a.props.onChange(e,t,n)},a.cleanSelectedKeys=function(){a.handleRowSelectChange([],[])},a}return(0,g.default)(t,e),(0,p.default)(t,[{key:"componentWillReceiveProps",value:function(e){0===e.selectedRows.length&&this.setState({selectedRowKeys:[],totalCallNo:0}),e.roledata&&this.setState({data:e.roledata.map(function(e){return void 0==e.selectStatus&&(e.selectStatus=!0),e})})}},{key:"renderColumns",value:function(e,t,a){var n=this;return b.default.createElement(E,{editable:t.editable,value:e,onChange:function(e){return n.handleChange(e,t.ID,a)}})}},{key:"edit",value:function(e){console.log("key",e);var t=(0,u.default)(this.state.data);console.log("newData",t);var a=t.filter(function(t){return e===t.ID})[0];a&&(console.log("target",a),a.editable=!0,this.setState({data:t.map(function(t){return e==t.ID&&(t.selectStatus=!1),t})}))}},{key:"save",value:function(e){var t=(0,u.default)(this.state.data),a=t.filter(function(t){return e===t.ID})[0];a&&(delete a.editable,void 0===a.role&&(a.role=a.title_id),this.setState({data:t}),this.props.handleSaveData(a))}},{key:"cancel",value:function(e){var t=(0,u.default)(this.state.data),a=t.filter(function(t){return e===t.ID})[0];a&&(delete a.editable,this.setState({data:t.map(function(t){return e==t.ID&&(t.selectStatus=!0),t})}))}},{key:"askdelete",value:function(e){var t=(0,u.default)(this.state.data),a=t.filter(function(t){return e===t.ID})[0];a&&(a.deleteable=!0,this.setState({data:t}))}},{key:"confirmdelete",value:function(e){var t=(0,u.default)(this.state.data),a=t.filter(function(t){return e===t.ID})[0];if(a){var n=t.indexOf(a);n>-1&&t.splice(n,1),a.tag=!1,this.setState({data:t}),this.cacheData=t.map(function(e){return(0,c.default)({},e)}),this.props.handleDeleteData(a)}}},{key:"handleChange",value:function(e,t,a){var n=(0,u.default)(this.state.data),l=n.filter(function(e){return t===e.ID})[0];l&&(l[a]=e,this.setState({data:n}))}},{key:"handleRoleValue",value:function(e,t,a){var n=(0,u.default)(this.state.data),l=n.filter(function(e){return t===e.ID})[0];l&&(l[a]=e,this.setState({data:n,disabled:!1}))}},{key:"handleSelectLineValue",value:function(e,t,a){var n=(0,u.default)(this.state.data),l=n.filter(function(e){return t===e.ID})[0];l&&(l[a]=e,l.group_title="请选择",l.group_id="-1",this.props.dispatch({type:"gproline/getProjectGroupbyId",payload:e}),this.setState({data:n,disabled:!1,selectedLine:!0}))}},{key:"canceldelete",value:function(e){var t=(0,u.default)(this.state.data),a=t.filter(function(t){return e===t.ID})[0];a&&(Object.assign(a,this.cacheData.filter(function(t){return e===t.ID})[0]),delete a.deleteable,this.setState({data:t}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.selectedRowKeys,n=(t.totalCallNo,t.data,this.props),l=n.roledata,c=n.assignInfo,u=[{title:"角色ID",dataIndex:"ID",key:"ID",width:"120px"},{title:"角色名称",dataIndex:"title",key:"title",width:"120px",render:function(t,a){return e.renderColumns(t,a,"username")}},{title:"用户数",dataIndex:"user_nums",key:"user_nums",width:"150px"},{title:"操作",dataIndex:"operation",key:"operation",width:"200px",render:function(t,a){var n=a.editable;a.deleteable;return b.default.createElement("div",{className:"editable-row-operations"},n?b.default.createElement("span",null,b.default.createElement("a",{onClick:function(){return e.save(a.ID)}},"保存"),b.default.createElement(d.default,{type:"vertical"}),b.default.createElement(i.default,{title:"确定取消?",onConfirm:function(){return e.cancel(a.ID)}},b.default.createElement("a",null,"取消"))):b.default.createElement("span",null,b.default.createElement(s.default,{onClick:function(){return e.edit(a.ID)}},"修改"),b.default.createElement(d.default,{type:"vertical"})),n?b.default.createElement("span",null):b.default.createElement("span",null,b.default.createElement(i.default,{title:"确定删除?",onConfirm:function(){return e.confirmdelete(a.ID)}},b.default.createElement(s.default,null,"删除")),b.default.createElement("span",null,b.default.createElement(d.default,{type:"vertical"}),b.default.createElement(w.default,{record:a.ID,assignInfo:c,dispatch:e.props.dispatch}))))}}],f={showSizeChanger:!0,showQuickJumper:!0},p={selectedRowKeys:a,onChange:this.handleRowSelectChange,getCheckboxProps:function(e){return{disabled:e.disabled}}};return b.default.createElement("div",{className:I.default.standardTable},b.default.createElement("div",{className:I.default.tableAlert},b.default.createElement(o.default,{message:b.default.createElement("div",null,"已选择 ",b.default.createElement("a",{style:{fontWeight:600}},a.length)," 个用户 ",b.default.createElement("a",{onClick:this.cleanSelectedKeys,style:{marginLeft:24}},"取消勾选")),type:"info",showIcon:!0})),b.default.createElement(r.default,{rowKey:function(e){return e.ID},rowSelection:p,dataSource:l,columns:u,pagination:f,onChange:this.handleTableChange}))}}]),t}(b.PureComponent),x=k;t.default=x},yIvT:function(e,t,a){"use strict";var n=a("0ZgE"),l=a("VY4n");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("UsS6");var r=n(a("xqAZ"));a("pdEl");var o=n(a("0Hx8"));a("sL9k");var s=n(a("BlmP"));a("hjcW");var i=n(a("Tmqy"));a("wPR8");var d=n(a("cmPo")),c=n(a("U2oY")),u=n(a("TFzq")),f=n(a("DEU0")),p=n(a("+hkI")),h=n(a("54rf")),m=n(a("oHNe"));a("0lkx");var g=n(a("gEKc"));a("6ASg");var v=n(a("pKc7"));a("M50D");var y,b,I,w=n(a("5Zb7")),E=l(a("bRCM")),k=a("rAnT"),x=n(a("obT9")),S=(n(a("GPpn")),n(a("T/Ci"))),D=(w.default.Item,v.default.Option,function(e){return Object.keys(e).map(function(t){return e[t]}).join(",")}),C=(g.default.TextArea,y=(0,k.connect)(function(e){return e}),b=w.default.create(),y(I=b(I=function(e){function t(){var e,a;(0,u.default)(this,t);for(var n=arguments.length,l=new Array(n),r=0;r<n;r++)l[r]=arguments[r];return a=(0,p.default)(this,(e=(0,h.default)(t)).call.apply(e,[this].concat(l))),a.state={expandForm:!1,selectedRows:[],formValues:{}},a.handleStandardTableChange=function(e,t,n){var l=a.props.dispatch,r=a.state.formValues,o=Object.keys(t).reduce(function(e,a){var n=(0,c.default)({},e);return n[a]=D(t[a]),n},{}),s=(0,c.default)({currentPage:e.current,pageSize:e.pageSize},r,o);n.field&&(s.sorter="".concat(n.field,"_").concat(n.order)),l({type:"gproline/getProjectList",payload:s})},a.handleRefreshTableChange=function(){(0,a.props.dispatch)({type:"gproline/getProjectLine",payload:""})},a.handleFormReset=function(){var e=a.props,t=e.form,n=e.dispatch;t.resetFields(),a.setState({formValues:{}}),n({type:"gproline/getProjectList",payload:{}})},a.toggleForm=function(){a.setState({expandForm:!a.state.expandForm})},a.handleMenuClick=function(e){var t=a.props.dispatch,n=a.state.selectedRows;if(n)switch(console.log(n),e.key){case"remove":t({type:"gproline/getProjectLine",payload:{ID:n.map(function(e){return e.ID}).join(",")},callback:function(){a.setState({selectedRows:[]})}});break;case"approval":t({type:"gproline/getProjectLine",payload:{ID:n.map(function(e){return e.ID}).join(",")},callback:function(){a.setState({selectedRows:[]})}});case"stop":t({type:"gproline/getProjectLine",payload:{ID:n.map(function(e){return e.ID}).join(",")},callback:function(){a.setState({selectedRows:[]})}})}},a.handleSelectRows=function(e){a.setState({selectedRows:e})},a.handleSaveData=function(e){var t=e.ID,n=e.group_id,l=e.pro_title,r=e.line_id,o=e.pro_alias,s=e.pro_code_url,i=e.pro_enable,d=e.pro_remarks;if("-1"!=n){var c={ID:t,title:l,alias:o,remarks:d,code_url:s,enable:i,groupid:n,lineid:r};a.props.dispatch({type:"gproline/modifyProject",payload:c})}else a.props.dispatch({type:"gproline/getProjectList"})},a.handleDeleteData=function(e){var t=e.ID,n={},l=[];l.push(t),n.ids=l,a.props.dispatch({type:"gproline/deleteProject",payload:{tag:!1,infolist:JSON.stringify(n)}})},a}return(0,m.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){(0,this.props.dispatch)({type:"grole/getRolelist"})}},{key:"render",value:function(){var e=this.state,t=e.selectedRows,a=(e.modalVisible,e.addInputValue,this.props.form.getFieldDecorator,this.props),n=a.grole,l=(a.loading,a.submitting,a.dispatch);console.log("grole",n);E.default.createElement(d.default,{onClick:this.handleMenuClick,selectedKeys:[]},E.default.createElement(d.default.Item,{key:"remove"},"删除"),E.default.createElement(d.default.Item,{key:"approval"},"批量启用"),E.default.createElement(d.default.Item,{key:"stop"},"批量暂停"));return E.default.createElement(r.default,{bordered:!1},E.default.createElement("div",{className:S.default.tableList},E.default.createElement("div",{className:S.default.tableListOperator},E.default.createElement(s.default,{gutter:16},E.default.createElement(i.default,{span:2}))),E.default.createElement(o.default,null," 角色列表 "),E.default.createElement(x.default,{selectedRows:t,dispatch:l,handleSaveData:this.handleSaveData,handleDeleteData:this.handleDeleteData,roledata:n.data,assignInfo:n.assignInfo,onSelectRow:this.handleSelectRows,onChange:this.handleStandardTableChange})))}}]),t}(E.PureComponent))||I)||I);t.default=C}}]);